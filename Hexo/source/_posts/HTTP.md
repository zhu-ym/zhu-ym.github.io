---
title: HTTP
typora-root-url: ../
date: 2021-01-05 20:47:29
tags:
 - HTTP
categories:
 - [计算机网络]
---



简单介绍HTTP协议在Web中的应用，简单了解其工作机制、HTTP报文信息、以及其版本迭代

<!--more-->

# 1.Web页面的呈现

Web主要通过在三项构建技术构建：通过**URL**进行资源定位，利用**HTTP**进行文本传输，最后使用**HTML**经浏览器解析、渲染后呈现出Web页面。

具体到客户端与Web服务器的交互上，整个过程如下图所示：

![image-20210105211339300](/images/image-20210105211339300.png)

- 首先是利用**DNS服务**得到URL到服务器IP地址的映射
- 利用得到的IP，之后**TCP**三次握手建立客户端到服务器的连接，保证可靠传输。在这段过程中，网络层在利用**IP协议**传输、期间可能用到**ARP协议**又得到该站到下一站中转设备MAC地址的映射。
- 建立好连接之后，客户端会发生HTTP请求报文，报文中包含一些信息
- 服务器收到请求报文后，返回HTTP响应报文
- 由于HTTP/1.1是默认连接是持久连接，可能还会多次重复前两步步骤，直到最后提出断开连接，才会断开TCP连接



**DNS补充**

DNS是分布式集群的层次结构的计算机和网络服务命名系统

一般主要可以分为根域名服务器、顶级域名服务器、权限域名服务器、本地域名服务器

当真的需要对域名的IP地址进行查询的时候，一般有以下方案

**客户端缓存**：查询客户端浏览器、本机系统是否缓存过该IP

**直接解析：**本地域名服务器有缓存

当本地服务器不能从本地缓存回复客户端时，又有两种方式查询

**递归查询：**本地DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域名的根域服务器查询，再由根域名服务器一级级向下查询。最后得到的查询结果返回给局部DNS服务器，再由本地DNS服务器返回给客户端。

**迭代查询：**当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。



# 2.HTTP概述

HTTP协议用于客户端和服务端之间，通过请求和响应报文的交换达成通信。HTTP不保存状态、1.1版本默认使用长连接节省通信量，但是为了实现期望的保持状态功能，引入了Cookie技术管理状态。

**HTTP的优缺点：**

- 优点
  - 简单灵活易于拓展
  - 应用广泛
- 缺点
  - 通信明文可能被窃听
  - 通信身份可能造伪装
  - 无法证明报文完整性，可能已经被篡改



学习HTTP,重点和难点就是在于其请求报文和响应报文的学习，下面是具体内容

# 3.HTTP请求报文

HTTP请求报文格式如下

![image-20210313101500745](/images/image-20210313101500745.png)

了解其格式之后，主要还得了解常用请求方法和一些请求头部字段的含义

## 请求方法

请求报文通过请求报文告知服务器自己的意图

**GET**

`获取资源`

GET方法用来访问已被URI识别的资源，指定的资源经服务器端解析后返回响应内容

GET方法是请求报文使用得最多的方法下面是一个常见的get访问URL

`http://mp.weixin.qq.com/s?src=11&timestamp=1615599911&...`

其？后面是一些传递的参数

**POST**

`传输实体的主体`

POST方法也可以获取响应，但更重要的目的是为了传输一些主体参数,虽然一般GET也能传输参数，但一般不用GET传输

**HEAD**

`获取报文首部`

和 GET 方法类似，但是不返回报文实体主体部分。

主要用于确认 URL 的有效性以及资源更新的日期时间等。

**PUT、DELETE**

`上传、删除文件`

由于HTTP/1.1的这两个方法不带验证机制，存在安全性问题，所以一般都不使用

**OPTIONS**

`查询服务器支持方法`

查询指定的 URL 服务器能够支持的方法。

**CONNECT**

`要求用隧道协议连接代理`

该方法要求在代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。一般主要使用SSL和TLS协议将通信内容加密后经网络隧道传输

## 首部字段

总的来说一个完整的HTTP请求报文包括，请求行、首部字段、其他和报文主题

首部字段又由请求首部字段、通用首部字段和实体首部字段

下面对这些字段进行介绍

### 通用首部字段

通用首部字段是指请求报文和响应报文都会使用的首部

| 首部字段名        | 说明                                       |
| ----------------- | ------------------------------------------ |
| Cache-Control     | 控制缓存的行为                             |
| Connection        | 控制不再转发给代理的首部字段、管理持久连接 |
| Date              | 创建报文的日期时间                         |
| Pragma            | 报文指令                                   |
| Trailer           | 报文末端的首部一览                         |
| Transfer-Encoding | 指定报文主体的传输编码方式                 |
| Upgrade           | 升级为其他协议                             |
| Via               | 代理服务器的相关信息                       |
| Warning           | 错误通知                                   |

### 请求首部字段

| 首部字段名          | 说明                                            |
| ------------------- | ----------------------------------------------- |
| Accept              | 用户代理可处理的媒体类型                        |
| Accept-Charset      | 优先的字符集                                    |
| Accept-Encoding     | 优先的内容编码                                  |
| Accept-Language     | 优先的语言（自然语言）                          |
| Authorization       | Web 认证信息                                    |
| Expect              | 期待服务器的特定行为                            |
| From                | 用户的电子邮箱地址                              |
| Host                | 请求资源所在服务器                              |
| If-Match            | 比较实体标记（ETag）                            |
| If-Modified-Since   | 比较资源的更新时间                              |
| If-None-Match       | 比较实体标记（与 If-Match 相反）                |
| If-Range            | 资源未更新时发送实体 Byte 的范围请求            |
| If-Unmodified-Since | 比较资源的更新时间（与 If-Modified-Since 相反） |
| Max-Forwards        | 最大传输逐跳数                                  |
| Proxy-Authorization | 代理服务器要求客户端的认证信息                  |
| Range               | 实体的字节范围请求                              |
| Referer             | 对请求中 URI 的原始获取方                       |
| TE                  | 传输编码的优先级                                |
| User-Agent          | HTTP 客户端程序的信息                           |

### 实体首部字段

| 首部字段名       | 说明                   |
| ---------------- | ---------------------- |
| Allow            | 资源可支持的 HTTP 方法 |
| Content-Encoding | 实体主体适用的编码方式 |
| Content-Language | 实体主体的自然语言     |
| Content-Length   | 实体主体的大小         |
| Content-Location | 替代对应资源的 URI     |
| Content-MD5      | 实体主体的报文摘要     |
| Content-Range    | 实体主体的位置范围     |
| Content-Type     | 实体主体的媒体类型     |
| Expires          | 实体主体过期的日期时间 |
| Last-Modified    | 资源的最后修改日期时间 |

# 4.HTTP响应报文

HTTP响应报文和请求报文类似，只是第一行叫状态行、再由响应首部和响应数据组成

## 状态码

状态码类别

![image-20210313111945041](/images/image-20210313111945041.png)

下面是一些常用状态码

**2XX:成功**

200 OK 正常处理

204 No Content 请求处理成功，但是没有资源可返回

206 Partial Content 客户端范围请求，请求成功

**3XX：重定向**

301 永久重定向       资源分配了新的URI，以后使用该URI

302 临时重定向       希望用户本次访问使用该URI

303 See Other         功能和302类似，但制定客户端用GET方法访问

304 Not Modified    如果请求报文首部包含一些条件，例如：If-Match，If-Modified-Since等如果不满足条件，则服务器会返回 304 状态码。

307   临时重定向，与 302 的含义类似，但是 307 要求浏览器不会把重定向请求的 POST 方法改成 GET 方法。

**4XX：客户端错误**

400 请求报文语法错误

401 HTTP认证

403 服务器拒绝访问

404 没有请求资源

**5XX：服务器错误**

500 服务器内部执行请求发生错误

503 服务器超负载或者停机

## 响应首部字段

| Accept-Ranges      | 是否接受字节范围请求         |
| ------------------ | ---------------------------- |
| Age                | 推算资源创建经过时间         |
| ETag               | 资源的匹配信息               |
| Location           | 令客户端重定向至指定 URI     |
| Proxy-Authenticate | 代理服务器对客户端的认证信息 |
| Retry-After        | 对再次发起请求的时机要求     |
| Server             | HTTP 服务器的安装信息        |
| Vary               | 代理服务器缓存的管理信息     |
| WWW-Authenticate   | 服务器对客户端的认证信息     |

# 5.HTTPS

前面说到HTTP有三个缺点。但是如果对这个三个缺点进行改进，即用

HTTP+加密+认证+完整性保护=HTTPS

HTTPS是身批SSL外壳的HTTP，SSL是指Secure Socket Layer，通常，HTTP直接与TCP通信，当使用SSL后，HTTP通信接口部分先和SSL通信，再由SSL和TCP通信

## SSL加密

### 加密方法

**对称密钥加密**

也叫共享密钥加密，即加密和解密用同一个密钥

- 优点：运算速度快；
- 缺点：无法安全地将密钥传输给通信方

**非对称密钥加密**

也叫公开密钥加密，加密和解密使用不同的密钥。

公开密钥所有人都可以获得，通信发送方获得接收方的公开密钥之后，就可以使用公开密钥进行加密，接收方收到通信内容（内含私有秘钥）后使用私有密钥解密。

非对称密钥除了用来加密，还可以用来进行签名。因为私有密钥无法被其他人获取，因此通信发送方使用其私有密钥进行签名，通信接收方使用发送方的公开密钥对签名进行解密，就能判断这个签名是否正确。

- 优点：可以更安全地将公开密钥传输给通信发送方；
- 缺点：运算速度慢。

### HTTPS加密

上面提到对称密钥加密方式的传输效率更高，但是无法安全地将密钥 Secret Key 传输给通信方。而非对称密钥加密方式可以保证传输的安全性，因此我们可以利用非对称密钥加密方式将 Secret Key 传输给通信方。之后再采用对称加密的方式进行通信。

即HTTPS采用混合加密机制

## 认证

通过使用 **证书** 来对通信方进行认证。

数字证书认证机构（CA，Certificate Authority）是客户端与服务器双方都可信赖的第三方机构。

服务器的运营人员向 CA 提出公开密钥的申请，CA 在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公开密钥证书后绑定在一起。

进行 HTTPS 通信时，服务器会把证书发送给客户端。客户端取得其中的公开密钥之后，先使用数字签名进行验证，如果验证通过，就可以开始通信了。

## 完整性保护

SSL 提供报文摘要功能来进行完整性保护。

HTTP 也提供了 MD5 报文摘要功能，但不是安全的。例如报文内容被篡改之后，同时重新计算 MD5 的值，通信接收方是无法意识到发生了篡改。

HTTPS 的报文摘要功能之所以安全，是因为它结合了加密和认证这两个操作。试想一下，加密之后的报文，遭到篡改之后，也很难重新计算报文摘要，因为无法轻易获取明文。



最后学习了加密、认证、完整性保护，可以发现HTTPS还是有一定缺点

- 因为需要进行加密解密等过程，因此速度会更慢
- 由于消耗更多的CPU资源，能处理的请求数量减少
- 需要支付证书授权的高额费用。

